#pragma config(Hubs,  S4, HTMotor,  HTMotor,  HTMotor,  HTServo)
#pragma config(Sensor, S2,     gyro,           sensorNone)
#pragma config(Sensor, S4,     ,               sensorI2CMuxController)
#pragma config(Motor,  mtr_S4_C1_1,     intake,        tmotorTetrix, openLoop, reversed)
#pragma config(Motor,  mtr_S4_C1_2,     driveL,        tmotorTetrix, openLoop, reversed)
#pragma config(Motor,  mtr_S4_C2_1,     launcher,      tmotorTetrix, openLoop, reversed, encoder)
#pragma config(Motor,  mtr_S4_C2_2,     liftL,         tmotorTetrix, openLoop, reversed, encoder)
#pragma config(Motor,  mtr_S4_C3_1,     driveR,        tmotorTetrix, openLoop, reversed, encoder)
#pragma config(Motor,  mtr_S4_C3_2,     liftR,         tmotorTetrix, openLoop)
#pragma config(Servo,  srvo_S4_C4_1,    goal,                 tServoStandard)
#pragma config(Servo,  srvo_S4_C4_2,    shrub,                tServoContinuousRotation)
#pragma config(Servo,  srvo_S4_C4_3,    net,                  tServoStandard)
//*!!Code automatically generated by 'ROBOTC' configuration wizard               !!*//

#include "menu.h";
#include "actions.h";

int intake_speed = 80;
int launcher_speed = 100;
bool goal_closed_control = 0;
bool net_up = 1;

int debug = 0;

task main()
{
    servo[shrub] = servo_stop;
    servo[net] = net_close;
    clearScreen();

    while(1){
        int left_lift = 0;
        int right_lift = 0;
        char display[16];
        char bat[16];

        sprintf(bat, "Bat: %f V", externalBattery/1000.0);
        displayMenuItem(bat);
        menu_size++;

        //Lift Control
        if(doMenuItem("lift up")){
            left_lift = 50;
            right_lift = 50;
        }
        if(doMenuItem("lift down")){
            left_lift = -50;
            right_lift = -50;
        }
        motor[liftL] = left_lift;
        motor[liftR] = right_lift;

        //Intake Control
        sprintf(display, "intake %i", intake_speed);
        bool intake_pressed = 0;
        if(doMenuItem(display)){
            intake_pressed = 1;
        }
        if(doMenuItem("inc intake") && time1[T2] >= 200){
            clearTimer(T2);
            intake_speed ++;
        }
        if(doMenuItem("dec intake") && time1[T2] >= 200){
            clearTimer(T2);
            -- intake_speed;
        }

        //Launcher Controls
        sprintf(display, "launcher %i", launcher_speed);
        bool launcher_pressed = 0;
        if(doMenuItem(display)){
            launcher_pressed = 1;
        }
        if(doMenuItem("inc launcher") && time1[T2] >= 200){
            clearTimer(T2);
            launcher_speed ++;
        }
        if(doMenuItem("dec launcher") && time1[T2] >= 200){
            clearTimer(T2);
            -- launcher_speed;
        }

        //Both Intake and Launcher
        if(doMenuItem("launch/intake")){
            intake_pressed = 1;
            launcher_pressed = 1;
        }

        {
            if(launcher_pressed)
            {
                clearTimer(T4);
            }
            motor[launcher] = (float)(clamp(lerp((float)time1[T4]/launcher_slow_time, launcher_speed, 0.0), 0.0, launcher_speed));
        }

        {
            motor[intake] = intake_speed*intake_pressed;
        }

        {
            //Goal Lock
            doToggleMenuItem("shut goal lock\0open goal lock", goal_closed_control);
            servo[goal] = goal_open + (goal_close-goal_open) * goal_closed_control;
        }
        {
            //Net
            doToggleMenuItem("open net\0shut net", net_up);
            servo[net] = net_open + (net_close-net_open) * net_up;
        }
        updateMenu();
    }
}
